<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.yedam.finalPrj.announcement.serviceImpl.AnnouncementMapper">
		
	
	<select id="searchList" resultType="com.yedam.finalPrj.announcement.service.AnnouncementSearch">
		<!-- 상태사항이 Y일 경우. -->
		SELECT * FROM ANNOUNCEMENT WHERE ANNOUNCEMENT_STATUS='Y'
		<choose>
			<!-- 제목검색 -->
			<when test="type !=null and type.equals('ANNOUNCEMENT_TITLE')">
				AND ANNOUNCEMENT_TITLE LIKE('%'||#{keyword}||'%')
			</when>
			<!-- 내용 검색 -->
			<when test="type !=null and type.equals('ANNOUNCEMENT_content')">
				AND ANNOUNCEMENT_TITLE LIKE('%'||#{keyword}||'%')
			</when>
		</choose>
	</select>
	<select id="findOne" resultType="com.yedam.finalPrj.announcement.service.Announcement">
		 SELECT * FROM ANNOUNCEMENT WHERE ANNOUNCEMENT_SERIAL = #{announcementSerial}
	</select>
			<!-- index 사용법이 애매해서 조금 더 봐야함. -->	
	<select id="findAll" resultType="com.yedam.finalPrj.announcement.service.Announcement">
		<![CDATA[
			SELECT announcement_serial,  announcement_title,  announcement_content,  announcement_date,  announcement_writer,  announcement_hidden,  announcement_view,  announcement_status,  announcement_cnt
			FROM	(SELECT /*+INDEX_DESC(ANNOUNCEMENT pk_ANNOUNCEMENT_serial) */
						rownum rn, announcement_serial,  announcement_title,  announcement_content,  announcement_date,  announcement_writer,  announcement_hidden,  announcement_view,  announcement_status,  announcement_cnt 
					from announcement where rownum <= #{pageNum} * #{amount})
			where rn > (#{pageNum}-1) * #{amount}
			ORDER BY announcement_serial DESC
		]]>
	</select>
	
	<insert id="insert" parameterType="com.yedam.finalPrj.announcement.service.Announcement">
	
	INSERT INTO ANNOUNCEMENT(ANNOUNCEMENT_SERIAL,  ANNOUNCEMENT_TITLE, ANNOUNCEMENT_CONTENT, ANNOUNCEMENT_DATE, ANNOUNCEMENT_WRITER, ANNOUNCEMENT_HIDDEN,  ANNOUNCEMENT_VIEW,  ANNOUNCEMENT_STATUS, ANNOUNCEMENT_CNT)  
	VALUES (ann_seq.nextval,  #{announcementTitle}, #{announcementContent}, #{announcementDate}, DEFAULT, #{announcementHidden}, #{announcementView}, DEFAULT, DEFAULT)
	</insert>
	
	<update id="update" parameterType="com.yedam.finalPrj.announcement.service.Announcement">
		UPDATE ANNOUNCEMENT SET ANNOUNCEMENT_TITLE = #{announcementTitle},  ANNOUNCEMENT_TITLE = #{announcementContent}, ANNOUNCEMENT_STATUS = #{announcementStatus} WHERE ANNOUNCEMENT_SERIAL = #{announcementSerial}
	</update>
	
	<delete id="delete" parameterType="com.yedam.finalPrj.announcement.service.Announcement">
		
	</delete>
	
	<select id="totalCnt" resultType="int">
		SELECT count(*)
		FROM ANNOUNCEMENT		
	</select>
</mapper>