<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.yedam.finalPrj.announcement.serviceImpl.AnnouncementMapper">
		
	
<sql id="AnnouncementPagingCriteria">
	<trim prefixOverrides="OR" suffix=") AND " prefix="(">
		<foreach collection="typeArr" item="type">
			<trim prefix="OR">
					<!-- 상태사항이 Y일 경우. -->
				<choose>
						<!-- 제목검색 -->
					<when test="type == 'announcementTitle'.toString()">
						AND ANNOUNCEMENT_TITLE LIKE('%'||#{keyword}||'%')
					</when>
						<!-- 내용 검색 -->
					<when test="type == 'announcementContent'.toString()">
						AND ANNOUNCEMENT_CONTENT LIKE('%'||#{keyword}||'%')
					</when>
				
				</choose>
			</trim>
		</foreach>
	</trim>
</sql>
	
	
	<select id="findOne" resultType="com.yedam.finalPrj.announcement.service.Announcement">
		 SELECT * FROM ANNOUNCEMENT WHERE ANNOUNCEMENT_SERIAL = #{announcementSerial}
	</select>
			<!-- index 사용법이 애매해서 조금 더 봐야함. -->	
	<select id="findAll" resultType="com.yedam.finalPrj.announcement.service.Announcement">
		<![CDATA[
			SELECT announcement_serial,  announcement_title,  announcement_content,  announcement_date,  announcement_writer,  announcement_hidden,  announcement_view,  announcement_status,  announcement_cnt
			FROM	(SELECT /*+INDEX_DESC(ANNOUNCEMENT pk_ANNOUNCEMENT_serial) */
						rownum rn, announcement_serial,  announcement_title,  announcement_content,  announcement_date,  announcement_writer,  announcement_hidden,  announcement_view,  announcement_status,  announcement_cnt 
					from announcement 
					where
		]]>
		<include refid="AnnouncementPagingCriteria"></include>
		 
			<![CDATA[			
					rownum <= #{pageNum} * #{amount}
					)
			where rn > (#{pageNum}-1) * #{amount}
		]]>
	</select>
	
	<insert id="insert" parameterType="com.yedam.finalPrj.announcement.service.Announcement">
	
	INSERT INTO ANNOUNCEMENT(ANNOUNCEMENT_SERIAL,  ANNOUNCEMENT_TITLE, ANNOUNCEMENT_CONTENT, ANNOUNCEMENT_DATE, ANNOUNCEMENT_WRITER, ANNOUNCEMENT_HIDDEN,  ANNOUNCEMENT_VIEW,  ANNOUNCEMENT_STATUS, ANNOUNCEMENT_CNT)  
	VALUES (ann_seq.nextval,  #{announcementTitle}, #{announcementContent}, #{announcementDate}, DEFAULT, #{announcementHidden}, #{announcementView}, DEFAULT, DEFAULT)
	</insert>
	
	<update id="update" parameterType="com.yedam.finalPrj.announcement.service.Announcement">
		UPDATE ANNOUNCEMENT SET ANNOUNCEMENT_TITLE = #{announcementTitle},  ANNOUNCEMENT_TITLE = #{announcementContent}, ANNOUNCEMENT_STATUS = #{announcementStatus} WHERE ANNOUNCEMENT_SERIAL = #{announcementSerial}
	</update>
	
	<delete id="delete" parameterType="com.yedam.finalPrj.announcement.service.Announcement">
		
	</delete>
	
	<select id="totalCnt" resultType="int">
		SELECT count(*)
		FROM ANNOUNCEMENT
		where
		<include refid="AnnouncementPagingCriteria"></include>
				ANNOUNCEMENT_SERIAL>0
	</select>
</mapper>